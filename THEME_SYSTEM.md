# AESCULAPIUS - Система переключения тем

## Описание

Система позволяет переключать интерфейс сайта между двумя режимами:

1. **Default (Зелёный CRT-монитор)** - Классический стиль с зелёным монохромом
2. **Fallout Mode (Янтарный Pip-Boy)** - Атомпанк эстетика в стиле Fallout: New Vegas

## Архитектура решения

### Файлы, участвующие в системе:

- **`/static/fallout-theme.css`** - Полный CSS для Fallout-стиля (новый файл)
- **`/static/retro_style.css`** - Исходный стиль (не изменён, только добавлены стили для button)
- **`/static/login_style.css`** - Стили логина (добавлены стили для кнопки переключения)
- **`/templates/login.html`** - Страница входа (добавлена кнопка переключения)
- **`/templates/terminal.html`** - Главная страница (добавлена скрытая кнопка переключения)

### Принцип изоляции (Conservative Approach):

Все стили Fallout-темы находятся в отдельном файле `fallout-theme.css` и активируются только при наличии класса `theme-fallout` на элементах `<html>` или `<body>`. Существующие стили **полностью консервируются** и не удаляются.

## Механика работы

### 1. Хранение состояния

Выбранная тема сохраняется в `localStorage` под ключом `themeMode`:
- `'fallout'` - Fallout режим активен
- `'default'` - Стандартный режим (или отсутствие значения)

### 2. Инициализация темы

На странице используется ранняя инициализация в `<head>`:

```html
<script>
    (function() {
        if (localStorage.getItem('themeMode') === 'fallout') {
            document.documentElement.classList.add('theme-fallout');
        }
    })();
</script>
```

Это предотвращает "вспышку" неправильного стиля при загрузке.

### 3. Переключение темы

На странице логина (рядом с INFO-кнопкой) находится кнопка переключения темы `.theme-toggle-button`:

- **Нажатие на кнопку:**
  - Переключает класс `theme-fallout` на элементах `document.body` и `document.documentElement`
  - Сохраняет выбор в `localStorage`
  - Плавная анимация переходов (0.6s)

На главной странице находится скрытая кнопка `.theme-toggle-button-terminal`:

- **Видна только при наведении на панель управления**
- **Расположена в углу control-panel**
- **Функциональность идентична кнопке на логине**

## Цветовая палитра Fallout-режима

```css
--pipboy-primary: #FFB642;      /* Янтарный основной цвет */
--pipboy-primary-dark: #CC8A2F; /* Тёмный янтарь */
--pipboy-accent: #FFD700;       /* Яркий жёлтый */
--pipboy-danger: #FF6B35;       /* Оранжевый (опасность) */
--pipboy-bg: #0F0F0F;           /* Глубокий чёрный */
```

## Элементы, которые меняют стиль

### В Fallout-режиме:

- **Цвета текста** - Зелёный → Янтарный
- **Фон экрана** - Зелено-чёрный → Тёмно-янтарный
- **Границы элементов** - Зелёные → Янтарные
- **CRT эффекты** - Адаптированы под новую палитру
- **Таблицы** - Янтарная палитра для статусов
- **Кнопки** - Янтарные бордеры и гловы
- **Модальные окна** - Янтарное оформление
- **Hover эффекты** - Инверсия цветов (янтарный фон, чёрный текст)

## JavaScript логика

### Основные функции:

#### На странице логина:
```javascript
// Переключение темы
themeToggleBtn.addEventListener('click', function() {
    isFalloutThemeActive = !isFalloutThemeActive;
    localStorage.setItem('themeMode', isFalloutThemeActive ? 'fallout' : 'default');
    
    if (isFalloutThemeActive) {
        document.body.classList.add('theme-fallout');
        document.documentElement.classList.add('theme-fallout');
    } else {
        document.body.classList.remove('theme-fallout');
        document.documentElement.classList.remove('theme-fallout');
    }
    
    updateThemeToggleButtonUI();
});
```

#### На главной странице:
- Аналогичная логика с элементом `themeToggleBtnTerminal`
- Срабатывает на `click` с `stopPropagation()` для предотвращения конфликтов

## Анимации и переходы

Все переходы осуществляются с помощью CSS `transition` (0.6s):

```css
body.theme-fallout,
body.theme-fallout * {
    transition: background-color 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                color 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                border-color 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                box-shadow 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
```

Плавная кривая `cubic-bezier(0.25, 0.46, 0.45, 0.94)` обеспечивает естественный переход.

## Кросс-браузерная совместимость

- **CSS Variables** - поддержка всех современных браузеров
- **classList API** - стандартный Web API
- **localStorage** - стандартный Web API
- **Clip-path** - используется для кнопок (fallback на обычный border для старых браузеров)

## Режимы видимости кнопок

### На странице логина:
- Кнопка `.theme-toggle-button` **всегда видна** рядом с INFO-кнопкой
- Позиция: `top: 20px; right: 80px;` (слева от INFO-кнопки)

### На главной странице:
- Кнопка `.theme-toggle-button-terminal` **скрыта по умолчанию**
- Становится видна при **наведении на .control-panel**
- Позиция: верхний правый угол панели управления
- `opacity: 0.5` при наведении, `opacity: 1` при наведении на саму кнопку

## Сохранение выбора

При навигации между страницами:

1. Пользователь выбирает тему на странице логина
2. Выбор сохраняется в `localStorage`
3. При переходе на главную страницу (`/monitor`) скрипт в `<head>` определяет тему
4. Если пользователь меняет тему на главной странице, выбор снова сохраняется
5. При возврате на логин (логаут) тема остаётся прежней

## Тестирование

### Проверить функциональность:

1. Загрузить страницу логина
2. Найти кнопку переключения (рядом с INFO, левее её)
3. Нажать кнопку - интерфейс должен плавно измениться на Fallout-режим
4. Обновить страницу - тема должна остаться Fallout-режимом
5. Залогиниться и перейти на главную страницу
6. Тема должна быть сохранена
7. Навести мышку на верхний правый угол control-panel
8. Должна появиться скрытая кнопка переключения
9. Нажать её - тема должна переключиться обратно

## Возможные улучшения

1. Добавить клавиатурный шоткат для переключения (например, `Ctrl+T`)
2. Добавить звуковые эффекты при переключении (механический клик)
3. Добавить переходные анимации с "глитч-эффектом"
4. Добавить третий режим (например, Cyberpunk-стиль)
5. Добавить пользовательский выбор цветовой палитры

## Заметки для разработчиков

- **Не модифицировать** исходные CSS-файлы для добавления новых тем
- **Всегда использовать** отдельные файлы для новых тем
- **Консервировать** существующие стили с помощью селекторов типа `body.theme-fallout`
- **Тестировать** переключение на разных браузерах
- **Убедиться**, что все анимации плавные и не вызывают заикания (jank)

---

**Версия документации:** 1.0  
**Последнее обновление:** 2026-02-02  
**Статус:** Готово к использованию ✓
